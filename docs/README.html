<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>OpenShift-Ansible Integration Lab</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>OpenShift-Ansible Integration Lab</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_0_introduction">0 Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_0_1_usecase">0.1 Usecase</h3>
<div class="paragraph">
<p>Today we are building a Widget inventory tracking system. It&#8217;s comprised of a simple data driven application backed by
MySQL. We will start with how to deploy and configure the MySQL server via Ansible, follow that up with how to manage
the application&#8217;s OpenShift deployment with Ansible, and finally bring the database automation into the OpenShift
Service Catalog.</p>
</div>
</div>
<div class="sect2">
<h3 id="_0_2_ansible_and_openshift">0.2 Ansible and OpenShift</h3>
<div class="paragraph">
<p>The goal of this lab is to show how the
<a href="https://docs.openshift.com/container-platform/latest/getting_started/index.html">OpenShift Container Platform</a>
and <a href="https://www.ansible.com/resources/get-started">Ansible Automation</a> can build on each other to increase innovation
and accelerate delivery.</p>
</div>
<div class="paragraph">
<p>First we&#8217;ll introduce how Ansible can be used to automate provisioning and configuration of application dependencies.
Then we&#8217;ll look at how we can leverage Ansible for application configuration within OpenShift as part of a pipeline.
Finally, we will dig into how the
<a href="https://docs.openshift.com/container-platform/3.11/architecture/service_catalog/ansible_service_broker.html">OpenShift
Ansible Broker</a> adds self-service automation to the platform.</p>
</div>
<div class="paragraph">
<p>The source code for this lab is on <a href="https://github.com/srang/rh-openshift-ansible-broker-lab">GitHub</a>, but we will be
doing most of our work in AWS so don&#8217;t worry about cloning the repo yet. One other thing to note is that the source code
will be available well after the lab (although not the lab environment itself) and will work mostly out of the box on
the Container Development Kit (it&#8217;s where the lab was developed) and I&#8217;ll likely publish a <code>minishift</code> branch that works
completely out of the box. Indicate interest in a minishift version of the lab by starring the repo and opening an
issue in GitHub.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_install_mysql_server_with_ansible_engine">1 Install MySQL Server with Ansible Engine</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_1_review_playbook">1.1 Review Playbook</h3>
<div class="paragraph">
<p>First you&#8217;ll need to connect to your lab. To do that you&#8217;ll need to ssh using your student account to the Master Node
for your student account. The command will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ssh -o 'StrictHostKeyChecking no' student1@ec2-18-234-37-92.compute-1.amazonaws.com &lt;- your Master Node</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can skip the <code>StrictHostKeyChecking</code> option and just accept host key check prompt.
Once on the Master Node, you&#8217;ll need to set up shop. First we&#8217;re gonna install <code>git</code> so we can pull down the lab source
code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ sudo yum install -y git</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;re gonna clone the lab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ git clone https://github.com/srang/rh-openshift-ansible-broker-lab.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now for convenience let&#8217;s define an environment variable on our Master Node that says where the source code is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ echo export GIT_BASE="$(pwd)/rh-openshift-ansible-broker-lab" &gt;&gt; ~/.bashrc
$ source ~/.bashrc
$ cd $GIT_BASE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we need to make sure we&#8217;re looking at the right branch of the lab (we don&#8217;t want to see the answers) so run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ git checkout master</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go into the <code>database-provision-playbook</code> directory and look around. This is a good opportunity to install your favorite
terminal-based editor (mine is and will always be <code>vim</code>). Adventurous developers could also fork the lab repository,
clone it locally (to your personal machine), edit code in an IDE, and update git remotes to pull from a fork but for the
purpose of this lab we will assume we&#8217;re working directly on the Master Node.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_provision_mysql_server_on_vm">1.2 Provision MySQL server on VM</h3>
<div class="paragraph">
<p>Most of this playbook is pre-configured for you, take a look at <code>database-provision.yml</code>. It is installing MariaDB (an
opensource fork of MySQL), configuring a database on the server, and adding a user for that database. Let&#8217;s try running
it!</p>
</div>
<div class="paragraph">
<p>In order to run this playbook in your environment, you&#8217;ll need to update the <code>hosts</code> file in the inventory folder.
The username needs to match <strong>your</strong> student account or you will get authentication errors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[all:vars]
ansible_user=student1 &lt;- This is the line that needs to be changed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, you&#8217;ll need to update <code>hosts</code> with the hosts in <strong>your</strong> lab. Update the <code>[db-server]</code> section with your
database node hostname.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[db-server]
ec2-54-161-113-184.compute-1.amazonaws.com &lt;- This should match your environments Database Node</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve made these updates, you&#8217;re ready to run the playbook (it may take a couple minutes on the 'install
mysql-server' step):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ansible-playbook -vv database-playbook.yml -i inventory/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s connect to the database and see what&#8217;s there</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ sudo yum install -y mariadb
$ mysql --host=ec2-54-161-113-184.compute-1.amazonaws.com --port=3306 --user=widget --password=widget01 widgettest
MariaDB [widgettest]&gt; show tables;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We should see that our database is <em>completely</em> empty. But we can fix that pretty easily. We&#8217;re going to jump ahead a
little bit and "deploy" our widget factory in our workspace and connect to the database there.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_run_canary_application">1.3 Run Canary Application</h3>
<div class="paragraph">
<p>In order to build and run our application, we&#8217;re going to need some tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $GIT_BASE/widget-factory
$ sudo yum install -y rh-maven35 --enablerepo=rhel-server-rhscl-7-rpms
$ scl enable rh-maven35 bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can run the app, but we need to add the database connection information. Open the <code>application-canary.yaml</code> file
in the <code>src/main/resources</code> folder, and update the jdbc url to have the correct host info:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  jpa.hibernate.ddl-auto: create
  datasource:
    url: jdbc:mysql://ec2-18-234-37-92.compute-1.amazonaws.com:3306/widgettest &lt;- this is the line needs updated hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that done we can build and run the application on our deployable canary profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mvn clean install -Popenshift
$ SPRING_PROFILES_ACTIVE=canary java -jar target/widget-factory.jar &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will start the job in the background (so it will log to <code>stdout</code> but you can still type commands, it&#8217;s easiest if
wait for the boot logs to finish). Now lets try hitting the service a couple times to see what&#8217;s been created, then
we can verify in the database that everything persists correctly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ curl localhost:8080/widgets
$ curl -H 'Content-type: application/json' -d '{"label": "NEW01", "version": "V1", "description": "some new thing"}' localhost:8080/widgets
$ curl localhost:8080/widgets</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can stop the application and dive into the db:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ kill %1
$ mysql --host=ec2-54-161-113-184.compute-1.amazonaws.com --port=3306 --user=widget --password=widget01 widgettest
MariaDB [widgettest]&gt; show tables;
MariaDB [widgettest]&gt; select * from widget;
MariaDB [widgettest]&gt; exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we should see a lot more (relatively) stuff in our database! So we can all stop and go home right? Wrong, there is a
lot more we can do to add stability, flexibility and security to our stack.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_deploy_application">2 Deploy Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve been running and testing things manually. Deploying to OpenShift adds stability, ensuring uptime and
scalability, and by defining a CI/CD pipeline, we standardize how the application is built and deployed. To start, let&#8217;s
create an OpenShift project. Make sure when logging in you are using the web console url for <strong>your</strong> lab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ oc login --insecure-skip-tls-verify=true https://ec2-18-234-37-92.compute-1.amazonaws.com -u admin -p redhat01 &lt;- Ensure to use correct OpenShift cluster
$ oc new-project widget-factory</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_2_1_auto_deploy_jenkins">2.1 Auto-deploy Jenkins</h3>
<div class="paragraph">
<p>A sample pipeline has already been defined for you in <code>widget-factory/Jenkinsfile</code>. One of the nice things about
OpenShift is how it integrates with Jenkins for CI/CD. By defining a pipeline build configuration, OpenShift will
automatically deploy Jenkins&#8201;&#8212;&#8201;more information on the mechanism behind this can be found in the
<a href="https://docs.openshift.com/container-platform/3.10/install_config/configuring_pipeline_execution.html">"Configuring
pipeline execution"</a> docs. Alternatively we could proactively deploy Jenkins using the Template Service Broker and the
OpenShift Service Catalog (more on these in later sections).</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_2_configure_widget_jenkins_agent">2.2 Configure <code>widget-jenkins-agent</code></h3>
<div class="paragraph">
<p>Before we can run our application pipeline we actually need to build a brand new Jenkins agent image. We need this for
tooling around our deployment playbook (explained in following sections).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $GIT_BASE/widget-jenkins-agent
$ oc process -f agent-pipeline.yml --param=SOURCE_REF=master | oc apply -f-</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are actually using pipelines to build our agent! It seems a little recursive but the idea of standardizing everything
with automation makes things repeatable and that leads to confidence in frequent deployments (which is awesome). Go into
the web console and watch your Jenkins instance come up, then we&#8217;ll kick off a build of our <code>widget-jenkins-agent</code>.
If you&#8217;d rather trigger a pipeline run from the CLI, you can run this command (once Jenkins is healthy):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ oc start-build widget-jenkins-agent-pipeline</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong> it may take a few minutes for Jenkins to finish its post deploy bootstrapping before running the build. Keep an
eye on the Jenkins master pod logs for indication as to whether its completed this bootstrapping.</p>
</div>
<div class="paragraph">
<p>Your password to Jenkins will be same as your OpenShift password (<code>admin</code>:`redhat01`). After this image is built, it
will automatically show up as an available agent in the kubernetes-plugin configuration section in your Jenkins instance
and can be used by specifying the label <code>widget-jenkins-agent</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_3_review_application">2.3 Review Application</h3>
<div class="paragraph">
<p>Now let&#8217;s finally take a look at that widget-factory service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $GIT_BASE/widget-factory</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s a simple-spring data service, one controller is setup as a <code>spring-data-rest</code> interface that autoconfigures CRUD
operations on our <code>widget</code> object. There is a second controller that exposes a service interface tied to a widget
repository interface allowing for building more custom queries. The important parts of the application (for the purpose
of this lab) are how we are planning to automate building, deploying and connecting the application to our database (for
now <code>widgettest</code> configured in Section 1).</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_4_ansible_openshift_applier">2.4 Ansible OpenShift Applier</h3>
<div class="paragraph">
<p>Let&#8217;s take a look inside the <code>.applier</code> folder, under <code>templates</code> you&#8217;ll see a number of YAML files specifying an
OpenShift template for various resources. As you may expect, <code>build.yml</code> specifies how to build and store the image,
while <code>deploy.yml</code> specifies how to deploy the application. The <code>db-service.yml</code> contains configuration for how to
connect to our database, exposing the external hostname of the server as an OpenShift internal service (more
<a href="https://docs.openshift.com/container-platform/3.10/dev_guide/integrating_external_services.html">info</a>). It also creates
the encoded secret <code>mysql</code> that our deployment uses.</p>
</div>
<div class="paragraph">
<p>This directory is used by an ansible role call the <a href="https://github.com/redhat-cop/openshift-applier"><code>openshift-applier</code></a>.
The role allows for template instantiation as an ansible-playbook which makes it easy to inject into a pipeline (which
is what we&#8217;ve done).</p>
</div>
<div class="paragraph">
<p>If you look at the stages of the pipeline, you&#8217;ll see mostly standard steps for building the jar, building the image,
and deploying it to the cluster, but there are also some ansible commands in the "Apply OpenShift Manifests with Ansible"
stage. These commands install the role from ansible galaxy and then apply the build, deploy and db configuration to our
namespace.</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_5_deploy_application">2.5 Deploy Application</h3>
<div class="paragraph">
<p>We are now ready to deploy our application (make sure the widget-jenkins-agent image has successfully built first).
Let&#8217;s create our pipeline, you&#8217;ll need to make sure to use the correct database hostname:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ oc process -f widget-pipeline.yml --param=SOURCE_REF=master --param=DATABASE_HOST=ec2-54-89-60-203.compute-1.amazonaws.com | oc apply -f-
$ oc start-build widget-factory-pipeline</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now go into Jenkins to watch your build continue. When it has completed, you should see it deployed in the web-console
with all the configuration necessary for it to connect to your <code>widgettest</code> database. Try using the route in OpenShift
to recreate the NEW widget we created in Section 1 (it gets deleted when the application redeploys as part of the schema
initialization).</p>
</div>
<div class="paragraph">
<p>It&#8217;s pretty cool seeing all these pieces come together, but what happens if you need another database? Will you have
someone ssh into the database box each and every time? Should you put the playbook in Ansible Tower? Will your ops team
have to run it for you even though its a relatively low impact development change? Let&#8217;s see if there is a better way to
handle this.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_self_service_mysql_db_provisioning">3 Self-service MySQL DB Provisioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have automation in place for provisioning a database server and adding a database to it, but we&#8217;ve been running it
manually. Now if only there were a way to bring that automation into the OpenShift Service Catalog for self-service
consumption by the application teams&#8230;&#8203; (hint: that&#8217;s exactly what we&#8217;re going to do).</p>
</div>
<div class="sect2">
<h3 id="_3_1_automation_service_broker">3.1 Automation Service Broker</h3>
<div class="paragraph">
<p>The <a href="https://docs.openshift.com/container-platform/3.10/architecture/service_catalog/ansible_service_broker.html">OpenShift
Ansible Broker</a> (or <a href="http://automationbroker.io/">Automation Broker</a>) provides a way to deploy playbooks via the OpenShift
Service Catalog. Playbooks are packaged as <a href="https://docs.openshift.com/container-platform/3.10/apb_devel/">Ansible Playbook
Bundles</a> which are lightweight images containing parametrized playbooks. Let&#8217;s try our hand at converting our
<code>database-provisioning-playbook</code> to an APB.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_2_build_an_apb">3.2 Build an APB</h3>
<div class="paragraph">
<p>First off, let&#8217;s make sure we&#8217;re in the right place to work on this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ git checkout my-apb
$ cd $GIT_BASE/database-provision-apb</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Jenkinsfile has been provided for you, but only for guidance. Unless you&#8217;ve forked the lab repository, you need to
trigger a <a href="https://docs.openshift.com/container-platform/3.10/dev_guide/dev_tutorials/binary_builds.html">Binary Build</a> for
OpenShift to pick up <strong>your</strong> code and not the upstream lab code. Additionally, we need the build to push to the
<code>openshift</code> namespace in order for the Ansible Broker to see the new image. That is a different namespace and will
require us to change up some permissions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ oc create imagestream database-provision-apb -n openshift
$ oc policy add-role-to-user system:image-builder system:serviceaccount:widget-factory:builder -n openshift
$ oc new-build --binary=true --name=database-provision-apb -n widget-factory
$ oc patch bc/database-provision-apb -p '{"spec": {"output":{"to": {"namespace": "openshift"}}}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a binary build that pushes to a new imagestream in the openshift namespace and gives the builder account
in our namespace permission to push to that imagestream.</p>
</div>
<div class="paragraph">
<p>Next we are going to need a couple more utilities for interacting with the broker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ sudo yum install -y apb --enablerepo=rhel-7-server-ose-3.11-rpms &lt;- yes the 3.11 rpms (we want latest of apb)
$ apb version &lt;- you have to run this to generate default config (and make sure it is 1.9.7 or higher)
$ sed -i 's/osb/ansible-service-broker/' ~/.apb/defaults.json
$ oc apply -f broker-config.yml
$ oc rollout latest dc/asb -n openshift-ansible-service-broker</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now it&#8217;s finally time to get our hands dirty. A skeleton APB is already created for you in this directory. The pieces to
note are the <code>apb.yml</code> which specifies required parameters, the <code>Dockerfile</code> which specifies how to build the image, and
the <code>playbooks</code> folder which is how OpenShift will invoke certain "actions" on the APB (these can probably stay as-is).</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: This is where you get to write some code</p>
</div>
<div class="paragraph">
<p>Use the Jenkinsfile for guidance on how to invoke builds but the basic steps are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ apb bundle prepare
$ oc start-build --follow --from-dir . database-provision-apb
$ apb broker bootstrap
$ apb broker catalog</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your APB should be listed when you run the <code>apb broker catalog</code> command. If it doesn&#8217;t, make sure to check the logs of
the broker (<code>oc logs --since=30s dc/asb -n openshift-ansible-service-broker</code>). If your APB is showing up in the <code>apb
broker catalog</code> command but not the service catalog, you may need to run <code>apb catalog relist</code> (and maybe refresh the
catalog page).</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_3_provision_database_and_credentials">3.3 Provision Database and Credentials</h3>
<div class="paragraph">
<p>Once your APB is being correctly listed in the <code>abp broker catalog</code> command, you&#8217;re ready to call it from the service
catalog. In the top right corner of the web-console there is an "Add to project" button that allows you to search the
catalog for your APB. You may need to rerun the <code>apb catalog relist</code> command to have the catalog reindex.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_4_update_application_to_use_bindings">3.4 Update Application to Use Bindings</h3>
<div class="paragraph">
<p>As long as your APB creates a secret with the same name (<code>mysql</code>) there shouldn&#8217;t be anything to do here except making
sure that your application pipeline doesn&#8217;t try to overwrite it (take a look at
<code>widget-factory/.applier/templates/db-service.yml</code>).</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-11-12 10:32:15 -0500
</div>
</div>
</body>
</html>