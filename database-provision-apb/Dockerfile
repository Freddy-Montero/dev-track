FROM ansibleplaybookbundle/apb-base:latest

LABEL com.redhat.apb.spec=\
"LS0tCgp2ZXJzaW9uOiAxLjAKbmFtZTogZGF0YWJhc2UtcHJvdmlzaW9uLWFwYgpkZXNjcmlwdGlv\
bjogcHJvdmlzaW9uIG15c3FsIGRhdGFiYXNlIG9uIHJlbW90ZSBzZXJ2ZXIKYmluZGFibGU6IFRy\
dWUKYXN5bmM6IG9wdGlvbmFsCnRhZ3M6CiAgLSBkYXRhYmFzZQogIC0gbXlzcWwKbWV0YWRhdGE6\
CiAgZGlzcGxheU5hbWU6ICJSZW1vdGUgTXlTUUwgRGF0YWJhc2UgKEFQQikiCiAgY29uc29sZS5v\
cGVuc2hpZnQuaW8vaWNvbkNsYXNzOiBpY29uLW15c3FsLWRhdGFiYXNlCiAgZG9jdW1lbnRhdGlv\
blVybDogImh0dHBzOi8vZ2l0aHViLmNvbS9zcmFuZy9yaC1vcGVuc2hpZnQtYW5zaWJsZS1icm9r\
ZXItbGFiL3RyZWUvbWFzdGVyL2RhdGFiYXNlLXByb3Zpc2lvbi1hcGIiCnBsYW5zOgogIC0gbmFt\
ZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IEEgTXlTUUwgRGF0YWJhc2Ugb24gZXhpc3Rpbmcg\
TXlTUUwgc2VydmVyCiAgICBmcmVlOiBUcnVlCiAgICBkZWZhdWx0OiBUcnVlCiAgICBtZXRhZGF0\
YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgIHBhcmFtZXRlcnM6IFtdCiMgICAgICAt\
IG5hbWU6IG15c3FsX2RhdGFiYXNlCiMgICAgICAgIGRlc2NyaXB0aW9uOiBUaGUgbmFtZSBvZiB0\
aGUgTXlTUUwgZGF0YWJhc2UKIyAgICAgICAgdHlwZTogc3RyaW5nCiMgICAgICAgIGRpc3BsYXlf\
dHlwZTogdGV4dAojICAgICAgICByZXF1aXJlZDogdHJ1ZQojICAgICAgICBwYXR0ZXJuOiAiXlth\
LXpBLVowLTlfXSpbYS16QS1aX10rW2EtekEtWjAtOV9dKiQiCiMgICAgICAtIG5hbWU6IG15c3Fs\
X3VzZXIKIyAgICAgICAgZGVzY3JpcHRpb246IFVzZXJuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIHRv\
IGNvbm5lY3QgdG8gTXlTUUwKIyAgICAgICAgdHlwZTogc3RyaW5nCiMgICAgICAgIGRlZmF1bHQ6\
IGRldmVsCiMgICAgICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOV9dKlthLXpBLVpfXStbYS16QS1a\
MC05X10qJCIKIyAgICAgICAgcmVxdWlyZWQ6IHRydWUKIyAgICAgIC0gbmFtZTogbXlzcWxfcGFz\
c3dvcmQKIyAgICAgICAgZGVzY3JpcHRpb246IFBhc3N3b3JkIHRvIGNvbm5lY3QgdG8gTXlTUUwK\
IyAgICAgICAgdHlwZTogc3RyaW5nCiMgICAgICAgIHJlcXVpcmVkOiB0cnVlCiMgICAgICAgIGRp\
c3BsYXlfdHlwZTogcGFzc3dvcmQKIyAgICAgIC0gbmFtZTogbXlzcWxfcm9vdF9wYXNzd29yZAoj\
ICAgICAgICBkZXNjcmlwdGlvbjogUm9vdCB1c2VycyBwYXNzd29yZCBmb3IgcHJvdmlzaW9uaW5n\
IGRhdGFiYXNlCiMgICAgICAgIHR5cGU6IHN0cmluZwojICAgICAgICByZXF1aXJlZDogdHJ1ZQoj\
ICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiMgICAgICAtIG5hbWU6IG15c3FsX2hvc3QK\
IyAgICAgICAgdHlwZTogc3RyaW5nCiMgICAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAojICAgICAg\
ICBkZXNjcmlwdGlvbjogSG9zdG5hbWUgZm9yIE15U1FMIHNlcnZlcgojICAgICAgICByZXF1aXJl\
ZDogdHJ1ZQ=="

COPY playbooks /opt/apb/actions
COPY . /opt/ansible/roles/database-provision-apb
RUN chmod -R g=u /opt/{ansible,apb}
USER apb