FROM ansibleplaybookbundle/apb-base:latest

LABEL com.redhat.apb.spec=\
"LS0tCgp2ZXJzaW9uOiAxLjAKbmFtZTogZGF0YWJhc2UtcHJvdmlzaW9uLWFwYgpkZXNjcmlwdGlv\
bjogcHJvdmlzaW9uIG15c3FsIGRhdGFiYXNlIG9uIHJlbW90ZSBzZXJ2ZXIKYmluZGFibGU6IFRy\
dWUKYXN5bmM6IG9wdGlvbmFsCnRhZ3M6CiAgLSBkYXRhYmFzZQogIC0gbXlzcWwKbWV0YWRhdGE6\
CiAgZGlzcGxheU5hbWU6ICJQcm92aXNpb24gUmVtb3RlIE15U1FMIERhdGFiYXNlIgogIGNvbnNv\
bGUub3BlbnNoaWZ0LmlvL2ljb25DbGFzczogaWNvbi1teXNxbC1kYXRhYmFzZQogIGRvY3VtZW50\
YXRpb25Vcmw6ICJodHRwczovL2dpdGh1Yi5jb20vc3Jhbmcvcmgtb3BlbnNoaWZ0LWFuc2libGUt\
YnJva2VyLWxhYi90cmVlL21hc3Rlci9kYXRhYmFzZS1wcm92aXNpb24tYXBiIgpwbGFuczoKICAt\
IG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBBIE15U1FMIERhdGFiYXNlIG9uIGV4aXN0\
aW5nIE15U1FMIHNlcnZlcgogICAgZnJlZTogVHJ1ZQogICAgZGVmYXVsdDogVHJ1ZQogICAgbWV0\
YWRhdGE6IHt9CiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IG15c3FsX2RhdGFiYXNlCiAg\
ICAgICAgZGVzY3JpcHRpb246IFRoZSBuYW1lIG9mIHRoZSBNeVNRTCBkYXRhYmFzZQogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOV9dKlthLXpBLVpfXStb\
YS16QS1aMC05X10qJCIKICAgICAgLSBuYW1lOiBteXNxbF91c2VyCiAgICAgICAgZGVzY3JpcHRp\
b246IFVzZXJuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGNvbm5lY3QgdG8gTXlTUUwKICAgICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgICBkZWZhdWx0OiBkZXZlbAogICAgICAgIHBhdHRlcm46ICJe\
W2EtekEtWjAtOV9dKlthLXpBLVpfXStbYS16QS1aMC05X10qJCIKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICAtIG5hbWU6IG15c3FsX3Bhc3N3b3JkCiAgICAgICAgZGVzY3JpcHRpb246IFBh\
c3N3b3JkIHRvIGNvbm5lY3QgdG8gTXlTUUwKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBy\
ZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBuYW1l\
OiBteXNxbF9yb290X3Bhc3N3b3JkCiAgICAgICAgZGVzY3JpcHRpb246IFJvb3QgdXNlcnMgcGFz\
c3dvcmQgZm9yIHByb3Zpc2lvbmluZyBkYXRhYmFzZQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgIC0gbmFtZTogbXlzcWxfaG9zdAogICAgICAgIGRlc2NyaXB0aW9uOiBIb3N0bmFtZSBmb3Ig\
TXlTUUwgc2VydmVyCiAgICAgICAgcmVxdWlyZWQ6IHRydWU="

COPY playbooks /opt/apb/actions
COPY . /opt/ansible/roles/database-provision-apb
RUN chmod -R g=u /opt/{ansible,apb}
USER apb