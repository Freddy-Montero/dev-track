FROM ansibleplaybookbundle/apb-base:latest

LABEL com.redhat.apb.spec=\
"LS0tCgp2ZXJzaW9uOiAxLjAKbmFtZTogZGF0YWJhc2UtcHJvdmlzaW9uLWFwYgpkZXNjcmlwdGlv\
bjogInByb3Zpc2lvbiBteXNxbCBkYXRhYmFzZSBvbiByZW1vdGUgc2VydmVyIgpiaW5kYWJsZTog\
dHJ1ZQphc3luYzogb3B0aW9uYWwKdGFnczoKICAtIGRhdGFiYXNlCiAgLSBteXNxbAptZXRhZGF0\
YToKICBkaXNwbGF5TmFtZTogIlJlbW90ZSBNeVNRTCBEYXRhYmFzZSAoQVBCKSIKICBjb25zb2xl\
Lm9wZW5zaGlmdC5pby9pY29uQ2xhc3M6IGljb24tbXlzcWwtZGF0YWJhc2UKICBkZXBlbmRlbmNp\
ZXM6IFtdCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHBzOi8vZ2l0aHViLmNvbS9zcmFuZy9yaC1v\
cGVuc2hpZnQtYW5zaWJsZS1icm9rZXItbGFiL3RyZWUvbWFzdGVyL2RhdGFiYXNlLXByb3Zpc2lv\
bi1hcGIiCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246ICJBIE15U1FM\
IERhdGFiYXNlIG9uIGV4aXN0aW5nIE15U1FMIHNlcnZlciIKICAgIGZyZWU6IHRydWUKICAgIGRl\
ZmF1bHQ6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAg\
cGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiBteXNxbF9kYXRhYmFzZQogICAgICAgIGRlc2NyaXB0\
aW9uOiBUaGUgbmFtZSBvZiB0aGUgTXlTUUwgZGF0YWJhc2UKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAg\
IHBhdHRlcm46ICJeW2EtekEtWjAtOV9dKlthLXpBLVpfXStbYS16QS1aMC05X10qJCIKICAgICAg\
LSBuYW1lOiBteXNxbF91c2VyCiAgICAgICAgZGVzY3JpcHRpb246IFVzZXJuYW1lIHRoYXQgd2ls\
bCBiZSB1c2VkIHRvIGNvbm5lY3QgdG8gTXlTUUwKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICBkaXBzbGF5X3R5cGU6IHRleHQKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfXSpbYS16\
QS1aX10rW2EtekEtWjAtOV9dKiQiCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSBuYW1l\
OiBteXNxbF9wYXNzd29yZAogICAgICAgIGRlc2NyaXB0aW9uOiBQYXNzd29yZCB0byBjb25uZWN0\
IHRvIE15U1FMCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIC0gbmFtZTogbXlzcWxfcm9vdF9wYXNz\
d29yZAogICAgICAgIGRlc2NyaXB0aW9uOiBSb290IHVzZXJzIHBhc3N3b3JkIGZvciBwcm92aXNp\
b25pbmcgZGF0YWJhc2UKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBkaXNwbGF5X3R5cGU6\
IHBhc3N3b3JkCiAgICAgIC0gbmFtZTogbXlzcWxfaG9zdAogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICAgIGRlc2NyaXB0aW9uOiBIb3N0bmFtZSBm\
b3IgTXlTUUwgc2VydmVyCiAgICAgICAgcmVxdWlyZWQ6IHRydWU="

COPY playbooks /opt/apb/actions
COPY . /opt/ansible/roles/database-provision-apb
RUN chmod -R g=u /opt/{ansible,apb}
USER apb