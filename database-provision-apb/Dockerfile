FROM ansibleplaybookbundle/apb-base:latest

LABEL com.redhat.apb.spec=\
"LS0tCgp2ZXJzaW9uOiAxLjEKbmFtZTogZGF0YWJhc2UtcHJvdmlzaW9uLWFwYgpkZXNjcmlwdGlv\
bjogInByb3Zpc2lvbiBteXNxbCBkYXRhYmFzZSBvbiByZW1vdGUgc2VydmVyIgpiaW5kYWJsZTog\
dHJ1ZQphc3luYzogb3B0aW9uYWwKdGFnczoKICAtIGRhdGFiYXNlCiAgLSBteXNxbAptZXRhZGF0\
YToKICBkaXNwbGF5TmFtZTogIlJlbW90ZSBNeVNRTCBEYXRhYmFzZSAoQVBCKSIKICBjb25zb2xl\
Lm9wZW5zaGlmdC5pby9pY29uQ2xhc3M6IGljb24tbXlzcWwtZGF0YWJhc2UKICBkb2N1bWVudGF0\
aW9uVXJsOiAiaHR0cHM6Ly9naXRodWIuY29tL3NyYW5nL3JoLW9wZW5zaGlmdC1hbnNpYmxlLWJy\
b2tlci1sYWIvdHJlZS9tYXN0ZXIvZGF0YWJhc2UtcHJvdmlzaW9uLWFwYiIKcGxhbnM6CiAgLSBu\
YW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogIkEgTXlTUUwgRGF0YWJhc2Ugb24gZXhpc3Rp\
bmcgTXlTUUwgc2VydmVyIgogICAgZnJlZTogdHJ1ZQogICAgZGVmYXVsdDogdHJ1ZQogICAgbWV0\
YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZhdWx0CiAgICBwYXJhbWV0ZXJzOiBbXQojICAg\
ICAgLSBuYW1lOiBteXNxbF9kYXRhYmFzZQojICAgICAgICBkZXNjcmlwdGlvbjogVGhlIG5hbWUg\
b2YgdGhlIE15U1FMIGRhdGFiYXNlCiMgICAgICAgIHR5cGU6IHN0cmluZwojICAgICAgICBkaXNw\
bGF5X3R5cGU6IHRleHQKIyAgICAgICAgcmVxdWlyZWQ6IHRydWUKIyAgICAgICAgcGF0dGVybjog\
Il5bYS16QS1aMC05X10qW2EtekEtWl9dK1thLXpBLVowLTlfXSokIgojICAgICAgLSBuYW1lOiBt\
eXNxbF91c2VyCiMgICAgICAgIGRlc2NyaXB0aW9uOiBVc2VybmFtZSB0aGF0IHdpbGwgYmUgdXNl\
ZCB0byBjb25uZWN0IHRvIE15U1FMCiMgICAgICAgIHR5cGU6IHN0cmluZwojICAgICAgICBkZWZh\
dWx0OiBkZXZlbAojICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfXSpbYS16QS1aX10rW2Et\
ekEtWjAtOV9dKiQiCiMgICAgICAgIHJlcXVpcmVkOiB0cnVlCiMgICAgICAtIG5hbWU6IG15c3Fs\
X3Bhc3N3b3JkCiMgICAgICAgIGRlc2NyaXB0aW9uOiBQYXNzd29yZCB0byBjb25uZWN0IHRvIE15\
U1FMCiMgICAgICAgIHR5cGU6IHN0cmluZwojICAgICAgICByZXF1aXJlZDogdHJ1ZQojICAgICAg\
ICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiMgICAgICAtIG5hbWU6IG15c3FsX3Jvb3RfcGFzc3dv\
cmQKIyAgICAgICAgZGVzY3JpcHRpb246IFJvb3QgdXNlcnMgcGFzc3dvcmQgZm9yIHByb3Zpc2lv\
bmluZyBkYXRhYmFzZQojICAgICAgICB0eXBlOiBzdHJpbmcKIyAgICAgICAgcmVxdWlyZWQ6IHRy\
dWUKIyAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAojICAgICAgLSBuYW1lOiBteXNxbF9o\
b3N0CiMgICAgICAgIHR5cGU6IHN0cmluZwojICAgICAgICBkaXNwbGF5X3R5cGU6IHRleHQKIyAg\
ICAgICAgZGVzY3JpcHRpb246IEhvc3RuYW1lIGZvciBNeVNRTCBzZXJ2ZXIKIyAgICAgICAgcmVx\
dWlyZWQ6IHRydWU="

COPY playbooks /opt/apb/actions
COPY . /opt/ansible/roles/database-provision-apb
RUN chmod -R g=u /opt/{ansible,apb}
USER apb