apiVersion: v1
kind: Template
labels:
  template: widget-factory-bootstrap
metadata:
  name: widget-factory-bootstrap
objects:
- kind: "BuildConfig"
  apiVersion: "v1"
  metadata:
    labels:
      application: ${APPLICATION_NAME}
    name: "${APPLICATION_NAME}-pipeline"
    namespace: "${APPLICATION_NAMESPACE}"
  spec:
    source:
      type: Git
      git:
        uri: ${APPLICATION_SOURCE_REPOSITORY_URL}
        ref: ${APPLICATION_SOURCE_REPOSITORY_REF}
      contextDir: ${APPLICATION_CONTEXT_DIR}
    strategy:
      type: "JenkinsPipeline"
      jenkinsPipelineStrategy:
        jenkinsfilePath: ${PIPELINE_SCRIPT}
        env:
        - name: "APPLICATION_SOURCE_REPOSITORY_URL"
          value: "${APPLICATION_SOURCE_REPOSITORY_URL}"
        - name: "APPLICATION_CONTEXT_DIR"
          value: "${APPLICATION_CONTEXT_DIR}"
parameters:
- description: The name for the application.
  name: APPLICATION_NAME
  required: true
  value: widget-factory
- description: The namespace to deploy into
  name: NAMESPACE
  required: true
- description: Git source URI for application
  displayName: Application source url
  name: APPLICATION_SOURCE_REPOSITORY_URL
  value: https://github.com/srang/rh-openshift-ansible-broker-lab.git
- description: Play Framework application source branch/tag reference.
  displayName: Play application source branch/tag reference.
  name: APPLICATION_SOURCE_REPOSITORY_REF
  value: master
- description: Path within Git project to build containing the application
  displayName: Application context directory.
  name: APPLICATION_CONTEXT_DIR
  value: widget-factory
- description: Path within Git project pointing to the pipeline run script
  name: PIPELINE_SCRIPT
  value: Jenkinsfile
- description: Namespace in which the ImageStreams for Red Hat Middleware images are
    installed. These ImageStreams are normally installed in the openshift namespace.
    You should only need to modify this if you've installed the ImageStreams in a
    different namespace/project.
  name: IMAGE_STREAM_NAMESPACE
  required: true
  value: openshift
- description: Image stream tag for the image you'd like to use to build the application
  name: IMAGE_STREAM_TAG_NAME
  required: true
  value: redhat-openjdk18-openshift:1.1